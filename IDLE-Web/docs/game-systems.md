# IDLE-Web Game Systems Deep Dive

> **Generated by**: codebase-cartographer
> **Last Updated**: 2026-01-29
> **Covers**: Game mechanics and subsystem behavior
> **Source**: IDLE_GDD.txt v6, service implementations

## Summary

Detailed documentation of major game systems: production, population, exploration, colonization, trade, and transport. Includes formulas, tier processing order, and edge cases.

## 1. Production System

### Tier-Order Processing (GDD v6 Section 8.1)

Production processes facilities in strictly ordered tiers to prevent circular dependencies:

```
Tier 1 (Extraction) → Tier 2 (Refining) → Tier 3 (Processing) → Tier 4 (Advanced) → Tier 5 (High-Tech)
```

#### Tier 1: Extraction
- **Input**: None (extract from planetary/stellar resources)
- **Output**: Raw resources (IronOre, Silicates, Ice, etc.)
- **Rate**: 100 t/h base rate
- **Example**: Mine produces 100t Iron Ore/hour

#### Tier 2: Refining
- **Input**: Raw resources
- **Output**: Refined resources
- **Capacity**: 200 t/h throughput
- **Efficiency**: 30-85% (varies by facility)
- **Example**: Smelter needs 1t Iron Ore to produce 0.5t Steel (50% efficiency)

#### Tier 3: Processing
- **Input**: Refined resources
- **Output**: Processed goods
- **Capacity**: 160 t/h (20% surplus to storage)
- **Efficiency**: 40-85%
- **Example**: Food Kitchen: 0.8t Grain + 0.2t Water → 1t Prepared Food (85% efficiency)

#### Tier 4: Advanced
- **Input**: Processed resources, sometimes multiple types
- **Output**: Advanced goods
- **Capacity**: 80 t/h (50% surplus)
- **Efficiency**: 35-70%
- **Example**: Electronics Fab: 0.4t Components + 0.3t Rare Earths + 0.3t Glass → Electronics

#### Tier 5: High-Tech
- **Input**: Advanced resources
- **Output**: Rare/exotic goods
- **Capacity**: 20 t/h (75% surplus)
- **Efficiency**: 20-40%
- **Example**: Synthetic Mind Forge: 0.6t AI Cores + 0.4t Quantum Materials → Synthetic Mind

### Production Processing Algorithm

```pseudocode
processProduction(deltaHours):
  // Sort all facilities by tier
  facilities = sort(allFacilities, by: tier)

  for each facility in facilities:
    if facility.tier === 1:
      // Extraction: just add to storage
      storage[facility.output] += facility.baseRate * deltaHours
      clamp storage to capacity
    else:
      // Conversion: check inputs first
      for each input in facility.inputs:
        if storage[input.resource] < input.amount * facility.throughput * deltaHours:
          facility.efficiency = (available / required) // run at reduced capacity

      // Consume inputs
      for each input in facility.inputs:
        storage[input.resource] -= input.amount * facility.throughput * deltaHours * facility.efficiency

      // Produce output
      storage[facility.output] += facility.throughput * deltaHours * facility.efficiency
      clamp storage to capacity

      // Overflow auto-sells to market at 80% sell price
      if storage[output] > capacity:
        overflow = storage[output] - capacity
        credits += overflow * basePrice * 0.8
        storage[output] = capacity
```

### Storage Overflow Handling

When production exceeds capacity:
1. Facility produces up to capacity
2. Excess is auto-sold to galactic market at 80% of base price
3. Credits added to player account
4. Notification sent if significant overflow

### Multi-Input Facilities

Facilities requiring multiple inputs check all before consuming:

```typescript
// Example: FuelRefinery
// Input: 0.5t Atmospheric Gases + 0.5t Hydrocarbons
// Throughput: 200 t/h, Efficiency: 0.6
// Output: 100 t/h Fuel

const atmosphericNeeded = 0.5 * throughput * deltaHours * efficiency;
const hydrocarbonsNeeded = 0.5 * throughput * deltaHours * efficiency;

if (storage.atmospheric < atmosphericNeeded || storage.hydrocarbons < hydrocarbonsNeeded) {
  // Run at reduced capacity
  const atmosphericRatio = storage.atmospheric / atmosphericNeeded;
  const hydrocarbonsRatio = storage.hydrocarbons / hydrocarbonsNeeded;
  efficiency *= Math.min(atmosphericRatio, hydrocarbonsRatio);
}
```

---

## 2. Population System

### Growth Formula (GDD v6 Section 10.6)

```
growth_per_second = base_rate × net_pull_factor × (1 - current/ceiling)²
```

**Parameters**:
- `base_rate`: 5 people/second (configured in PopulationService)
- `net_pull_factor`: Sum of all pull factors (-1.0 to +1.0 typical range)
- `(1 - current/ceiling)²`: Capacity dampening

**Example Growth Rates**:
| Situation | Net Pull | % of Ceiling | Growth/sec |
|-----------|----------|-------------|-----------|
| New colony, lots of room | +1.0 | 20% | +3.2 |
| Stable system | +0.5 | 50% | +0.6 |
| Near capacity | +1.0 | 90% | +0.05 |
| Food shortage | -0.3 | 50% | -0.4 |
| Famine crisis | -1.0 | 50% | -1.25 |

### Floor & Ceiling

**Floor (Minimum Workers)**:
```
floor = sum of all facility floors in system
```

- Population cannot drop below floor
- Minimum viable workers for infrastructure
- When new facility completes, if population < new floor, instantly set to floor

**Ceiling (Maximum Inhabitants)**:
```
ceiling = sum of (facility_ceiling × body_type_multiplier)
```

| Body Type | Multiplier | Notes |
|-----------|-----------|-------|
| EarthLike | 2.0x | Perfect conditions |
| Terraformable | 1.5x | Good conditions |
| Terrestrial/Rocky | 1.0x | Baseline |
| Metal-Rich | 1.0x | Industrial |
| Gas Giant (orbital) | 0.6x | Less desirable |
| Star (orbital) | 0.5x | Dangerous |
| Icy Moon | 0.3x | Cold, dark |

### Pull Factors (GDD v6 Section 10.7)

Population growth driven by combined pull factors:

| Factor | Direction | Trigger | Value |
|--------|-----------|---------|-------|
| Food Quality | Up | Prepared Foods | +0.1 |
| Food Quality | Up | Quality Foods | +0.2 |
| Food Quality | Up | Gourmet Foods | +0.3 |
| Consumer Goods | Up | Basic Goods | +0.1 |
| Consumer Goods | Up | Comfort Goods | +0.2 |
| Consumer Goods | Up | Luxury Goods | +0.3 |
| Medical | Up | Medical facility present | +0.1 |
| Security | Up | Security adequate | +0.1 |
| Capacity Gap | Up | Distance below ceiling | Sliding scale |
| Facility Demand | Up | Pop below floor | Sliding scale |
| Food Scarcity | Down | Production < consumption | -0.1 to -0.5 |
| Ceiling Overshoot | Down | Pop above ceiling | Gentle push |

**Net Pull Factor Calculation**:
```typescript
calculatePullFactors(systemId): number {
  let netPull = 0;

  // Check food quality
  if (hasResource(GourmetFoods)) netPull += 0.3;
  else if (hasResource(QualityFoods)) netPull += 0.2;
  else if (hasResource(PreparedFoods)) netPull += 0.1;

  // Check consumer goods (same pattern)
  // Check medical, security, etc.

  // Food scarcity penalty
  if (foodProduction < foodConsumption) {
    const shortage = 1 - (foodProduction / foodConsumption);
    netPull -= shortage * 0.5; // -0.1 to -0.5
  }

  return netPull;
}
```

### Per Capita Consumption (GDD v6 Section 10.8)

Resources consumed by population (exact rates TBD via playtesting):

| Resource | Rate per 1k pop/hour | Notes |
|----------|-------------------|-------|
| Prepared Foods | TBD | Basic nutrition |
| Purified Water | TBD | Life support |
| Basic Goods | TBD | Consumer needs |

**Formula**:
```
consumption = (baseRate / 1000) * systemPopulation * deltaHours
```

### Production Bonus from Population (GDD v6 Section 10.9)

Population provides logarithmic production multiplier:

```
production_multiplier = 1 + log₁₀(system_population / 1,000)
```

| System Population | Multiplier | Notes |
|-------------------|-----------|-------|
| 1,000 | 1.0x | Baseline |
| 10,000 | 2.0x | Small colony |
| 100,000 | 3.0x | Established |
| 1,000,000 | 4.0x | Major hub |
| 10,000,000 | 5.0x | Megacity |

**Design Intent**: Makes large populations valuable but not game-breaking. 10M pop is 5x better than 1k, not 10,000x.

### System States

Triggered by population conditions:

**Positive States**:
- **Stable**: Normal operation
- **Prosperous**: Excellent conditions
- **Boom**: Rapid growth
- **Gold Rush**: Exceptional resources nearby
- **Golden Age**: Peak productivity

**Negative States**:
- **Disaster Recovery**: Rebuilding from crisis
- **Famine**: Food production < 70% of consumption
- **Outbreak**: Medical crisis, population decline
- **Rioting**: Security inadequate, population chaos
- **Insurgency**: Complete system failure

---

## 3. Exploration & Discovery System

### Scout Missions (GDD v6 Section 13)

**Scout Ship Capabilities**:
- Range: 10 ly (upgradeable with Range Modules)
- Must return before relaunching
- Fuel cost scales with distance

**Discovery Process**:
1. Player launches scout from current system
2. Scout travels outbound to frontier (distance calculated)
3. Upon arrival, system generated immediately
4. Scout surveys all bodies and features (integrated in MVP)
5. Scout returns with complete data
6. System marked as discovered upon return

**Exploration Frontier**:
- Tracks all frontier points expanding from Sol
- New systems placed outward from frontier
- Void-filling algorithm biases toward gaps
- Prevents clustering at boundary

### Coordinate System (GDD v6 Section 3)

**Layout**:
- 2D plane: home system (Sol) at origin (0, 0)
- Distance measured in light-years
- Expansion creates roughly circular bubble

**Distance Calculation**:
```
distance_from_home = √(x² + y²)

// Route distance
route_distance = √((x2-x1)² + (y2-y1)²)
```

### System Generation (GDD v6 Section 4)

**Rarity Tiers**:
| Tier | Chance | Bodies | Resources |
|------|--------|--------|-----------|
| Common | 50% | 1-3 | Low |
| Uncommon | 30% | 3-5 | Moderate |
| Rare | 15% | 5-8 | Rich |
| Exceptional | 4% | 8-12 | Abundant |
| Legendary | 1% | 10-15+ | Pristine |

**Body Type Distribution** (varies by rarity):
- Star(s): 1-2 orbital slots
- Planets: 2-3 types (Terrestrial, Terraformable, EarthLike, Gas Giant)
- Moons: 0-4 per planet
- Features: Random by body type

---

## 4. Colonization System

### Flow (GDD v6 Section 14)

```
Scout → Survey → Colonize → Develop → Trade
```

### Prerequisites (GDD v6 Section 14.2)
- System must be scouted
- Player must have available cargo ship
- Origin system must have required resources

### Colony Ship Mechanics (GDD v6 Section 14.4-14.8)

**Creation**:
- Temporary orbital structure at target body
- Accumulates delivered cargo across trips
- Cannot be interacted with directly
- Persists indefinitely if interrupted

**Construction Requirements**:
| Resource | Amount | Total |
|----------|--------|-------|
| Steel | 100t | 300t |
| Glass/Ceramics | 50t | |
| Prepared Foods | 100t | |
| Purified Water | 50t | |

**Conversion**:
- Upon completion, colony ship converts to Trade Outpost (Tier 1)
- Trade Outpost starts empty (no stored resources)
- System status changed to "Colonized"

### First Colony Protection (GDD v6 Section 14.7)

Player's first colonization attempt is fully protected:
- No breakdown rolls during first mission
- Ship and cargo guaranteed safe
- Ensures successful establishment before RNG applies
- Subsequent colonizations follow normal ship condition rules

### Post-Colonization Development

Colonized systems unlock:
- One-time cargo missions for construction materials
- Facility construction on surveyed bodies
- Trade routes to established production

---

## 5. Trade & Transport System

### Trade Routes (GDD v6 Section 15.5)

**Just-In-Time Loading (JIT)**:
```
Unlike one-time missions, routes do NOT reserve resources upfront.
Resources checked and loaded when ship arrives.

Rationale:
- Routes are long-lived (days/weeks real-time)
- Upfront reservation would lock resources indefinitely
- JIT adds management gameplay (must ensure steady production)
- Allows dynamic resource allocation across routes
```

**Route Lifecycle** (GDD v6 Section 15.5.2):

```
Phase 1: At Origin (System A)
  1. Check outbound cargo availability (JIT)
     - For each requested resource: load what's available
     - If 0 available: ship waits
  2. Check fuel availability for full round-trip
  3. Deduct cargo and fuel from origin
  4. Ship status: InTransit to System B

Phase 2: At Destination (System B)
  1. Unload outbound cargo
  2. Check return cargo availability (JIT)
  3. Check fuel for return leg
  4. Deduct cargo and fuel from destination
  5. Ship status: InTransit to System A

Phase 3: At Origin (System A)
  1. Unload return cargo
  2. Repeat from Phase 1 (start next cycle)
```

**Partial Loading**:
```typescript
// Example: Route requests 500t Steel, system has 300t available
// Ship loads 300t and departs
// Fuel consumed based on 300t (actual), not 500t (requested)
// If 0t available: ship waits at system
```

**Waiting States**:
- Ship waits if cargo/fuel unavailable
- Ship waits if destination storage full
- Waiting is automatic - no player interaction needed
- Ship resumes automatically when resources/space available

### One-Time Missions (GDD v6 Section 15.4)

#### One-Way Mission
```
Setup:
1. Select idle freighter
2. Select destination
3. Configure cargo (fixed amounts)
4. Resources RESERVED immediately at origin
5. Fuel RESERVED for one-way trip

Execution:
1. Resources deducted from origin
2. Fuel deducted from origin
3. Ship travels to destination
4. Cargo unloaded to destination
5. Ship becomes idle at destination (new location)
```

#### Round-Trip Mission
```
Setup:
1. Select idle freighter
2. Select destination
3. Configure BOTH outbound and return cargo
4. All resources RESERVED at both systems
5. ALL fuel RESERVED at origin (round-trip cost)

Execution:
1. Outbound cargo + fuel deducted from origin
2. Ship travels and unloads outbound cargo
3. Return cargo deducted from destination
4. Ship returns to origin
5. Return cargo unloaded
6. Ship becomes idle at origin
```

### Fuel Consumption (GDD v6 Section 15.6)

**Formula**:
```
fuel_cost = distance × cargo_weight × ship_efficiency / efficiency_modifier

Ship Sizes:
- Light: 0.5 efficiency, 2.0 ly/h speed
- Medium: 0.4 efficiency, 1.5 ly/h speed
- Heavy: 0.3 efficiency, 1.0 ly/h speed
- Bulk: 0.2 efficiency, 0.5 ly/h speed
```

**Example**:
```
Distance: 10 ly
Cargo: 500t
Ship: Medium (efficiency 0.4)
Modifier: 1.0 (no upgrades)

Fuel = 10 × 500 × 0.4 / 1.0 = 2,000t fuel
```

**By Mission Type**:
- **One-Way**: Fuel from origin for single leg
- **Round-Trip**: ALL fuel from origin (both legs calculated at heaviest load)
- **Recurring Route**: Fuel consumed at each departure point (different from round-trip!)

### Travel Time (GDD v6 Section 15.7)

**Formula**:
```
travel_time_hours = distance / (ship_speed × ship_modifier)
```

**Cargo Weight**: Does NOT affect travel time (engines compensate)

### Communications Bonuses (GDD v6 Section 15.8)

When Comms facilities cover BOTH route endpoints:

| Facility | Range | Travel | Fuel | Reliability |
|----------|-------|--------|------|-------------|
| Comms Outpost | 10 ly | -5% | -5% | +5% |
| Comms Station | 20 ly | -10% | -10% | +10% |
| Comms Hub | 30 ly | -15% | -15% | +15% |

**Coverage Example**:
```
System A has Comms Station (20 ly range)
System B has no Comms facility
Route distance: 15 ly

System B is within range of System A's station
→ Bonus applies: -10% time, -10% fuel, +10% reliability
```

### Storage Overflow (GDD v6 Section 15.4.3)

When ship arrives with cargo but destination storage full:

```
Scenario: Ship carrying 500t Steel, destination has 50t free space

Behavior:
1. Ship attempts to unload
2. Only 50t fits in storage
3. Remaining 450t stays on ship
4. Ship status: Idle (with cargo aboard)
5. Ship cannot accept new missions while carrying cargo
6. Notification: "Storage full at [System]—[Ship] waiting to unload"

Resolution:
1. Player must free up storage space
2. Ship automatically completes unload when space available
3. Ship then becomes available for new missions
```

**Design Intent**: Teaches logistics planning. Players must ensure destination has adequate storage before sending large shipments.

### Ship Status States (GDD v6 Section 15.9)

**MVP States**:
- **Idle**: At system, available for new missions (may be waiting for cargo/fuel)
- **InTransit**: Traveling between systems or handling cargo at destination

**Post-MVP States**:
- **Loading**: Ship at station, loading cargo (adds time delay)
- **Unloading**: Ship at station, unloading cargo (adds time delay)
- **Stranded**: Ship breakdown, needs rescue
- **Lost**: Ship destroyed, route auto-cancelled

---

## 6. Galactic Market (GDD v6 Section 15.11)

**Instant buy/sell for convenience**:
- Sell price: 75-90% of base value (randomized per transaction)
- Buy price: 100% of base value
- Spread: 10-25% lost vs. direct trade
- Finance economy: Reduces spread
- No fuel cost, no travel time, no ship required

**Use Cases**:
- Emergency resource acquisition
- Dumping excess production when storage full
- Quick credits when needed
- Convenience when physical trade impractical

**Design Intent**: Galactic market is for convenience and emergencies. Physical trade routes are more efficient for ongoing commerce but require infrastructure and planning.

---

## 7. Construction System

### Cost Calculation (GDD v6 Section 5.2)

```
cost = base_price × (1.03 ^ distance_ly) × (1.06 ^ facility_count)
```

**Example**:
| Distance | Facilities | Multiplier | Base 100 | Actual |
|----------|-----------|-----------|----------|--------|
| 5 ly | 5 | 1.55x | 100 | 155 |
| 10 ly | 10 | 2.40x | 100 | 240 |
| 20 ly | 20 | 5.81x | 100 | 581 |
| 30 ly | 40 | 25x | 100 | 2,500 |

**Distance Scaling**: Each light-year = 3% additional cost
**Facility Count**: Each existing facility on body = 6% additional cost

### Construction Process (GDD v6 Section 5.3)

```
Base construction cost = several hours of play without multipliers
Real-world build time applies after resources sourced
Creates natural pacing for idle gameplay
```

---

## 8. Economy Types & Specialization

### Available Economy Types
Agriculture, Mining, Industry, Tech, Military, Finance, Tourism, Medical, Communications, XenoSciences, Trade

### Support Facility Bonuses

| Facility | Economy | Bonuses |
|----------|---------|---------|
| Trade Outpost/Station/Hub | Trade | Trade capacity (1/2/3) |
| Research Center | Tech | Tech level +1 |
| Security Station | Military | Security level +1 |
| Comms Outpost/Station/Hub | Communications | Comms range, fuel/travel reduction |
| Financial Center | Finance | Credit bonus |
| Tourism Center | Tourism | Credit bonus + SoL bonus |

---

## 9. Prestige System (GDD v6 Section 24)

### New Game+ Loop

Prestige score calculated from final empire:
- Storage tonnage
- Credits balance
- Total population

### What Resets
- All systems except Sol
- All resources and credits
- All ships (reset to starting fleet)
- Galaxy map (new procedural generation)
- Sol facilities (reset to starting configuration)

### What Persists
- Prestige tokens and accumulated bonuses
- Achievements/statistics
- Unlocked knowledge (player skill)

### Balancing
- First prestige should feel earned (~1 week minimum)
- Subsequent prestiges faster but still meaningful
- Bonuses must not compound to game-breaking levels
- Consider diminishing returns or soft caps

---

## 10. Offline Progression (GDD v6 Section 20)

### Active Play
- Fast ticks (100-200ms) for smooth UI
- Real-time production/consumption updates

### Offline Calculation
- Batch calculation on return (not incremental)
- Production accumulates (up to storage cap)
- Overflow auto-sells for credits
- Trade routes operate normally
- Population drifts, states may change
- No offline cap (storage limits natural ceiling)

### Deferred Events
- Scout returns wait for player to "open"
- Survey completions queued
- Notifications summarize offline progress

---

## Source Files Referenced

- `/IDLE_GDD.txt` - Complete game design documentation
- `/src/app/services/production.service.ts` - Tier processing
- `/src/app/services/population.service.ts` - Growth and pull factors
- `/src/app/services/exploration.service.ts` - Scout missions
- `/src/app/services/colonization.service.ts` - Colonization flow
- `/src/app/services/trade.service.ts` - Trade routes and market
- `/src/app/services/supply-transport.service.ts` - Transport missions
- `/src/app/services/construction.service.ts` - Building mechanics
