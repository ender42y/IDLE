# IDLE-Web Service API Reference

> **Generated by**: codebase-cartographer
> **Last Updated**: 2026-01-29
> **Covers**: All services in `/src/app/services/`
> **Scope**: Complete method signatures and behavioral documentation

## Summary

Quick lookup of all public service methods, signals, and their signatures. Services use dependency injection with `inject()` and are provided at root level.

## GameStateService

**Role**: Central state management hub. All state reads/writes go through here.

**Injection**: `private gameState = inject(GameStateService);`

### Signals (Readonly Computed)

| Signal | Type | Description |
|--------|------|-------------|
| `credits` | Signal<number> | Player currency |
| `systems` | Signal<Record<string, StarSystem>> | All systems |
| `bodies` | Signal<Record<string, CelestialBody>> | All celestial bodies |
| `facilities` | Signal<Record<string, Facility>> | All facilities |
| `ships` | Signal<Record<string, Ship>> | Fleet inventory |
| `tradeRoutes` | Signal<Record<string, TradeRoute>> | Active routes |
| `scoutMissions` | Signal<Record<string, ScoutMission>> | Scout progress |
| `notifications` | Signal<Notification[]> | Message queue |
| `stats` | Signal<GameStats> | Player statistics |
| `settings` | Signal<GameSettings> | Game settings |
| `marketPrices` | Signal<Record<ResourceId, {buy,sell}>> | Market prices |
| `selectedSystemId` | Signal<string\|null> | UI selection |
| `selectedBodyId` | Signal<string\|null> | UI selection |
| `selectedSystem` | Signal<StarSystem\|null> | Computed from selection |
| `selectedBody` | Signal<CelestialBody\|null> | Computed from selection |
| `systemsList` | Signal<StarSystem[]> | All systems as array |
| `discoveredSystems` | Signal<StarSystem[]> | Explored systems |
| `colonizedSystems` | Signal<StarSystem[]> | Established systems |
| `shipsList` | Signal<Ship[]> | Fleet as array |
| `idleShips` | Signal<Ship[]> | Ships not on missions |
| `unreadNotifications` | Signal<Notification[]> | Unread messages |

### Methods

#### State Access

```typescript
getState(): GameState
// Returns complete game state snapshot

getSystem(systemId: string): StarSystem | undefined
// Get single system by ID

getBody(bodyId: string): CelestialBody | undefined
// Get single body by ID

getFacility(facilityId: string): Facility | undefined
// Get single facility by ID

getShip(shipId: string): Ship | undefined
// Get single ship by ID

getNotifications(): Notification[]
// Get all notifications
```

#### System Operations

```typescript
updateSystem(systemId: string, updates: Partial<StarSystem>): void
// Update system properties (colonized, state, population, etc.)

addSystem(system: StarSystem): void
// Add new discovered system to state

selectSystem(systemId: string): void
// Set UI selected system (null to deselect)
```

#### Body Operations

```typescript
updateBody(bodyId: string, updates: Partial<CelestialBody>): void
// Update body (facilities, orbital/surface slots)

addBody(body: CelestialBody): void
// Add new celestial body
```

#### Facility Operations

```typescript
addFacility(facility: Facility): void
// Add completed facility

updateFacility(facilityId: string, updates: Partial<Facility>): void
// Update facility (condition, operational status, progress)

removeFacility(facilityId: string): void
// Remove facility (unused in MVP)
```

#### Ship Operations

```typescript
addShip(ship: Ship): void
// Add new ship to fleet

updateShip(shipId: string, updates: Partial<Ship>): void
// Update ship (status, location, cargo, condition)

removeShip(shipId: string): void
// Remove destroyed ship
```

#### Trade/Transport Operations

```typescript
addTradeRoute(route: TradeRoute): void
// Register new recurring trade route

updateTradeRoute(routeId: string, updates: Partial<TradeRoute>): void
// Update route status or stats

removeTradeRoute(routeId: string): void
// Delete trade route

addScoutMission(mission: ScoutMission): void
// Register scout mission

updateScoutMission(missionId: string, updates: Partial<ScoutMission>): void
// Update mission progress

addTransportMission(mission: TransportMission): void  // NEW
// Register transport mission

updateTransportMission(missionId: string, updates: Partial<TransportMission>): void  // NEW
// Update transport mission
```

#### Resource Management

```typescript
modifyResources(systemId: string, changes: Record<ResourceId, number>): void
// Add/subtract resources (positive for production, negative for consumption)
// Enforces storage cap and prevents negative values

addCredits(amount: number): void
// Increase player credits

spendCredits(amount: number): boolean
// Decrease credits if sufficient funds exist

getSystemStorage(systemId: string): Record<ResourceId, ResourceStock>
// Get all resources in system with capacities
```

#### Notifications

```typescript
addNotification(notification: Omit<Notification, 'id' | 'timestamp' | 'read'>): void
// Queue new notification
// ID and timestamp generated automatically
// Type: 'info' | 'success' | 'warning' | 'danger'

markNotificationRead(notificationId: string): void
// Mark notification as read

clearAllNotifications(): void
// Remove all notifications
```

#### Settings

```typescript
updateSettings(settings: Partial<GameSettings>): void
// Change game settings (tickRate, autoSave, theme, etc.)

saveGame(): void
// Manually save to localStorage

loadGame(): boolean
// Load from localStorage (called on app init)

createInitialState(): GameState
// Generate fresh new game state (private but used in constructor)
```

---

## GameLoopService

**Role**: Drives game progression via regular ticks.

**Injection**: `private gameLoop = inject(GameLoopService);`

### Signals

| Signal | Type | Description |
|--------|------|-------------|
| `isRunning` | Signal<boolean> | Game loop active? |
| `tickCount` | Signal<number> | Total ticks since start |
| `currentTime` | Signal<number> | Current game time (ms) |

### Methods

```typescript
startGameLoop(): void
// Begin ticking at configured rate (default 200ms)
// Called in app initialization

stopGameLoop(): void
// Pause game progression

tick(deltaMs: number): void
// Process single game tick
// Called by interval timer or manually
// Triggers ProductionService, PopulationService, TradeService updates
// Persists state periodically based on autoSaveInterval

calculateOfflineTime(): number
// Compute elapsed time since last session
// Called on app resume
// Returns milliseconds offline

processOfflineProgression(offlineMs: number): void
// Batch calculate production, population changes while offline
// Updates state with accumulated progress
// Notifies player of changes
```

---

## ExplorationService

**Role**: Scout missions, system discovery, frontier management.

**Injection**: `private exploration = inject(ExplorationService);`

### Methods

```typescript
launchScoutMission(shipId: string): boolean
// Send scout to explore frontier
// Returns success/failure
// Creates ScoutMission, marks ship InTransit
// Calculates travel distance to frontier

completeMission(missionId: string): boolean
// Finish scout mission after reaching frontier
// Receives complete system data
// Generates new StarSystem with bodies and features
// Marks system as discovered
// Returns ship to idle

getScoutMissionProgress(missionId: string): number
// Returns 0-100% progress
```

---

## ColonizationService

**Role**: Colonization missions, colony ship mechanics, trade outpost establishment.

**Injection**: `private colonization = inject(ColonizationService);`

### Methods

```typescript
startColonization(shipId: string, systemId: string, bodyId: string): boolean
// Begin colonization mission
// GDD v6 Section 14: Prerequisites check
// - System must be discovered
// - Ship must be idle freighter
// - Origin must have construction resources
// Creates temporary Colony Ship at target body
// Returns success/failure with notification

deliverToColony(shipId: string, missionId: string): boolean
// Shuttle cargo to colony in progress
// Validates storage capacity at origin
// Marks cargo as delivered
// Updates colony ship resource accumulation
// Returns ship to idle after unload

completeColonization(missionId: string): boolean
// Convert colony ship to trade outpost when resources complete
// GDD v6 Section 14.5: Construction requirements
// - 100t Steel, 50t Glass, 100t Food, 50t Water
// Removes temporary colony ship
// Adds Trade Outpost (Tier 1) facility
// Updates system colonized status

getColonizationProgress(missionId: string): {
  delivered: Record<ResourceId, number>;
  required: Record<ResourceId, number>;
  percent: number;
}
// Returns progress toward completion
```

---

## ConstructionService

**Role**: Facility construction, cost calculation, validation.

**Injection**: `private construction = inject(ConstructionService);`

### Methods

```typescript
canBuild(facilityId: FacilityId, bodyId: string): {
  canBuild: boolean;
  reason?: string;
  cost?: { credits: number; resources: Record<ResourceId, number> };
}
// Check if facility can be built on body
// Validates:
// - Correct slot type (surface/orbital)
// - Slot availability
// - Tech level requirements (future)
// Returns cost breakdown if buildable

buildFacility(
  facilityId: FacilityId,
  bodyId: string,
  systemId: string
): boolean
// Start facility construction
// GDD v6 Section 5.2: Cost formula
// cost = base × (1.03 ^ distance_ly) × (1.06 ^ facility_count)
// Deducts resources/credits from system storage
// Creates Facility with constructionProgress = 0
// Returns success/failure

completeFacility(facilityId: string): boolean
// Mark facility construction complete
// Sets operational = true
// Updates system population floor/ceiling

calculateConstructionCost(
  facilityId: FacilityId,
  systemId: string
): { credits: number; resources: Record<ResourceId, number> }
// Compute exact cost for given system
// Applies distance and facility count multipliers
```

---

## ProductionService

**Role**: Resource extraction, conversion, tier-order processing.

**Injection**: `private production = inject(ProductionService);`

### Methods

```typescript
processProduction(deltaHours: number): void
// Main production tick for all facilities
// GDD v6 Section 8.1: Pull-based production
// 1. Sort facilities by tier (extractors → refiners → processors → advanced)
// 2. For each facility:
//    - If T1: extract and add to storage
//    - If T2+: check inputs, consume, produce
// 3. Handle storage overflow (auto-sell excess)

getProductionRate(facilityId: string): {
  input?: Record<ResourceId, number>;
  output: ResourceId;
  rate: number;  // tonnes per hour
}
// Get current production rate of facility

getSystemProduction(systemId: string): {
  resources: Record<ResourceId, number>;  // t/h rates
  surplus: Record<ResourceId, number>;    // overflow
}
// Get net production for entire system

calculateThroughputDecay(tier: FacilityTier): number
// Return capacity modifier by tier
// Tier 1: 100 t/h base
// Tier 2: 200 t/h capacity (2x throughput)
// Tier 3: 160 t/h (20% surplus)
// Tier 4: 80 t/h (50% surplus)
// Tier 5: 20 t/h (75% surplus)
```

---

## PopulationService

**Role**: Population growth, pull factor calculation, standard of living.

**Injection**: `private population = inject(PopulationService);`

### Methods

```typescript
calculatePopulationGrowth(systemId: string, deltaHours: number): number
// Compute population change for this tick
// GDD v6 Section 10.6: Growth formula
// growth = base_rate × net_pull × (1 - current/ceiling)²
// Updates system population
// Triggers system state changes if needed (Famine, Rioting, etc.)
// Returns new population value

calculatePullFactors(systemId: string): {
  [key: string]: number;
}
// Aggregate all population pull factors
// GDD v6 Section 10.7 factors:
// - Food quality (+0.1/+0.2/+0.3)
// - Consumer goods (+0.1/+0.2/+0.3)
// - Medical facilities (+0.1)
// - Security adequate (+0.1)
// - Food scarcity (-varies)
// - Ceiling overshoot (-varies)
// Returns sum total net pull factor

getSystemPopulationCeiling(systemId: string): number
// Sum of (facility ceiling × body type multiplier)
// GDD v6 Section 10.5

getSystemPopulationFloor(systemId: string): number
// Sum of all facility floor values
// Minimum viable population for operations

calculateConsumption(systemId: string): Record<ResourceId, number>
// Per capita consumption rates
// Scales by system population
// Returns demand per hour

hasEnoughFood(systemId: string): boolean
// Check if food production >= consumption
// Affects pull factors (food scarcity if false)
```

---

## TradeService

**Role**: Trade route management, galactic market, one-time missions.

**Injection**: `private trade = inject(TradeService);`

### Methods

```typescript
setupTradeRoute(
  shipId: string,
  destinationSystemId: string,
  config: {
    outbound: Record<ResourceId, number>;
    return: Record<ResourceId, number>;
  }
): boolean
// Create new recurring trade route
// GDD v6 Section 15.5: Route setup
// Validates:
// - Origin/destination station tiers match ship size
// - Cargo fits ship capacity
// - Ships become assigned to route
// - Route starts cycling immediately (JIT loading)
// Returns success/failure

cancelTradeRoute(routeId: string): void
// Stop route execution
// GDD v6 Section 15.5.7: Cancellation behavior
// If InTransit: completes current leg then idle
// If waiting: becomes idle immediately
// If cargo aboard: delivers before becoming idle

processTradeRoutes(deltaHours: number): void
// Tick all active routes
// For each ship on route:
// - Check cargo availability (JIT loading)
// - Load what's available (partial loading ok)
// - Check fuel availability
// - Travel if can proceed
// - Unload at destination
// - Handle storage overflow

buyFromMarket(resourceId: ResourceId, amount: number): boolean
// Purchase from galactic market
// GDD v6 Section 15.11: Buy price = 100% base value
// Deducts credits from player
// Adds to system storage
// Returns success/failure

sellToMarket(resourceId: ResourceId, amount: number): boolean
// Sell to galactic market
// GDD v6 Section 15.11: Sell price = 75-90% (randomized)
// Removes from system storage
// Adds credits to player
// Returns success/failure

getMarketPrice(resourceId: ResourceId): {
  buy: number;
  sell: number;
}
// Get current prices
// Fluctuates slightly over time
```

---

## SupplyTransportService (NEW - GDD v6 Section 15)

**Role**: One-way missions, round-trip missions, recurring transport routes.

**Injection**: `private transport = inject(SupplyTransportService);`

### Methods

```typescript
launchOneWayMission(
  shipId: string,
  destinationSystemId: string,
  cargo: Record<ResourceId, number>
): boolean
// One-way delivery mission
// GDD v6 Section 15.4.1
// - Resources RESERVED upfront
// - Fuel deducted for one-way trip
// - Ship relocates permanently to destination
// Returns success/failure

launchRoundTripMission(
  shipId: string,
  destinationSystemId: string,
  outbound: Record<ResourceId, number>,
  returnCargo: Record<ResourceId, number>
): boolean
// Fetch quest mission
// GDD v6 Section 15.4.2
// - Both legs' resources RESERVED upfront
// - All fuel consumed from origin (round trip cost)
// - Return cargo must be available at destination
// Returns success/failure

setupTransportRoute(
  shipId: string,
  destinationSystemId: string,
  config: {
    outbound: Record<ResourceId, number>;
    return: Record<ResourceId, number>;
  }
): boolean
// Recurring transport route (like TradeService but with transport paradigm)
// GDD v6 Section 15.5: Route setup
// Just-in-time loading (no upfront reservation)
// Ship waits if cargo/fuel unavailable
// Returns success/failure

processTransportMission(missionId: string, deltaHours: number): void
// Tick single transport mission forward
// GDD v6 Section 15.4.3 + 15.5.2: Full mission lifecycle
// Handles:
// - Travel time calculation (distance / ship_speed)
// - Cargo unload (with storage overflow handling)
// - Partial loading if insufficient cargo
// - Waiting states (fuel/cargo/storage full)
// - Auto-resume when resources available

cancelTransportMission(missionId: string): void
// Stop mission
// If InTransit: complete current leg then idle
// If waiting: become idle immediately
// Cargo delivered/remains on ship accordingly

calculateFuelCost(
  shipId: string,
  distance: number,
  cargoWeight: number
): number
// GDD v6 Section 15.6.1: Fuel formula
// cost = distance × cargo_weight × efficiency / modifier
// Efficiency varies by ship size (Light 0.5 → Bulk 0.2)

calculateTravelTime(
  shipId: string,
  distance: number
): number
// GDD v6 Section 15.7: Travel time
// time = distance / (speed × modifier)
// Speed varies by ship size (Light 2.0 → Bulk 0.5 ly/hour)

getTransportMissionStatus(missionId: string): TransportMission | undefined
// Get mission details
```

---

## GalaxyGeneratorService

**Role**: Procedural star system generation, body creation, feature assignment.

**Injection**: `private galaxyGen = inject(GalaxyGeneratorService);`

### Methods

```typescript
generateSystem(seed: number): StarSystem
// Create random star system
// GDD v6 Section 4.1: System rarity tiers
// Generates:
// - System name (procedural)
// - Rarity tier (50/30/15/4/1%)
// - Celestial bodies (1-15 based on rarity)
// - Features (High Metal, Fertile Soil, etc.)
// Returns complete StarSystem with bodies

placeSystemInGalaxy(
  seed: number,
  frontier: {x: number; y: number}[]
): {x: number; y: number}
// Calculate coordinates for new system
// GDD v6 Section 3.2: Expansion pattern
// Places outward from frontier
// Biases toward empty space (void filling)
// Returns coordinates {x, y}

generateBodies(systemRarity: SystemRarity): CelestialBody[]
// Create celestial bodies for system
// GDD v6 Section 4.2: Body types
// Stars: 1-2 orbital slots
// Planets: 2-3 orbital, 1-5 surface slots
// Moons: 1 orbital, 0-3 surface slots
// Assigns features randomly based on body type

generateBodyFeatures(bodyType: BodyType): BodyFeature[]
// Assign special features to body
// High Metal Content: mining bonus
// Fertile Soil: agriculture bonus
// Ice Deposits: water source
// Etc.
```

---

## PrestigeService

**Role**: Prestige/reset mechanics for New Game+.

**Injection**: `private prestige = inject(PrestigeService);`

### Methods

```typescript
calculatePrestigeTokens(gameState: GameState): number
// GDD v6 Section 24.2: Prestige score calculation
// Based on:
// - Total storage tonnage
// - Credits balance
// - Total population
// Minimum ~1 week of play for first token

prestigeReset(gameState: GameState): GameState
// GDD v6 Section 24.5: What resets
// Keeps:
// - Prestige tokens and bonuses
// - Achievements/statistics
// Resets:
// - All systems except Sol
// - All resources and credits
// - All ships (to starting fleet)
// - Galaxy map (new generation)
// - Sol facilities (to starting config)
// Returns new game state

getPrestigeBonus(): number
// Returns accumulated production/speed bonus
// 0.1% per token or less (prevents trivialization)
```

---

## StellarForge

**Role**: Ship construction and upgrades.

**Injection**: `private forge = inject(StellarForge);`

### Methods

```typescript
buildShip(
  type: ShipType,
  size: ShipSize,
  tier: ShipTier,
  systemId: string
): boolean
// Construct new ship
// Future: Implement actual construction mechanics
// Deducts resources/credits
// Adds Ship to fleet
// Returns success/failure

upgradeShip(shipId: string, upgrade: ShipUpgrade): boolean
// Upgrade ship modules
// Future: Speed, Range, Sensor modules
// Improves ship_speed_modifier or ship_fuel_efficiency
// Deducts credits/resources
// Returns success/failure
```

---

## HomeSystemService

**Role**: Home system (Sol) initialization.

**Injection**: `private homeSys = inject(HomeSystemService);`

### Methods

```typescript
initializeHomeSystem(state: GameState): GameState
// Create starting Sol system
// GDD v6 Section 2: Home System Overview
// Creates:
// - Sol star
// - 7 celestial bodies (Sol 1-4, moons)
// - Starting facilities per GDD spec
// - Starting resources (10,000 credits, etc.)
// - Starting ships (1 scout, 1 freighter)
// Returns updated GameState

getStartingResources(): Record<ResourceId, number>
// GDD v6 Section 2.5: Starting inventory
// 10,000 credits, 500t Steel, 200t Glass, etc.
```

---

## Service Dependency Graph

```
GameStateService (root)
  ↑ (injected by all)

GameLoopService
  → ProductionService
  → PopulationService
  → TradeService
  → SupplyTransportService

ExplorationService
  → GalaxyGeneratorService
  → GameStateService

ColonizationService
  → ConstructionService
  → GameStateService

TradeService
  → GameStateService

SupplyTransportService
  → GameStateService

GalaxyGeneratorService
  (standalone)

PrestigeService
  → GameStateService

StellarForge
  → GameStateService

HomeSystemService
  → GameStateService
```

## Notification Types Used Throughout Services

| Type | Usage | Examples |
|------|-------|----------|
| 'success' | Positive completion | "Colony established", "Mission launched" |
| 'warning' | Caution/problem | "Not enough resources", "Storage full" |
| 'danger' | Critical issue | "Ship destroyed", "Famine declared" |
| 'info' | Neutral information | "Discovery complete", "Offline progress calculated" |

## Return Value Pattern

All service methods that modify state return `boolean`:
- `true` = action succeeded, notification sent
- `false` = action failed, notification explains why
- No exceptions thrown in normal flows

## Source Files Referenced

- `/src/app/services/game-state.service.ts`
- `/src/app/services/game-loop.service.ts`
- `/src/app/services/exploration.service.ts`
- `/src/app/services/colonization.service.ts`
- `/src/app/services/construction.service.ts`
- `/src/app/services/production.service.ts`
- `/src/app/services/population.service.ts`
- `/src/app/services/trade.service.ts`
- `/src/app/services/supply-transport.service.ts` (NEW)
- `/src/app/services/galaxy-generator.service.ts`
- `/src/app/services/prestige.service.ts`
- `/src/app/services/stellar-forge.ts`
- `/src/app/services/home-system.service.ts`
